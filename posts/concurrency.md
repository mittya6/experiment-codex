---
title: "エラー処理とデバッグ：VBAのトラブルに強くなる"
date: "2024-12-01"
---

# エラー処理とデバッグの重要性

VBAで開発を進めていくと、**思わぬエラーや不具合**に遭遇することがあります。そのままでは処理が止まったり、ユーザーに不親切な表示が出たりしてしまいます。

そこで、エラー発生時に適切な対処を行う「エラー処理」と、問題の原因を突き止める「デバッグ」の基本を理解しておくことが重要です。

# エラーの種類

VBAでよく発生するエラーには、次のようなものがあります：

| 種類       | 内容                    |
| -------- | --------------------- |
| コンパイルエラー | 文法ミスなど、実行前に検出されるエラー   |
| 実行時エラー   | 実行中に発生するエラー（ゼロ除算など）   |
| 論理エラー    | 正常終了しているが、結果が間違っている場合 |

# On Error構文によるエラー処理

## 基本構文

```vba
On Error GoTo ラベル名
    ' 処理内容
Exit Sub

ラベル名:
    ' エラー時の処理
```

## 例：割り算でゼロ除算を処理する

```vba
Sub DivideNumbers()
    On Error GoTo ErrHandler

    Dim a As Double, b As Double
    a = 10
    b = 0
    MsgBox a / b

    Exit Sub

ErrHandler:
    MsgBox "エラー発生: " & Err.Description
End Sub
```

# On Error Resume Next

```vba
On Error Resume Next
```

この構文を使うと、**エラーが発生しても無視して次の行に進みます。**

一見便利ですが、**エラーに気づかないまま処理が進む**リスクもあるため、使用には注意が必要です。

# エラー情報を取得する

VBAでは、発生したエラーの情報を以下のように取得できます：

* `Err.Number`：エラー番号
* `Err.Description`：エラーの説明文
* `Err.Source`：エラーの発生元

# デバッグの基本操作

## F8で1行ずつ実行（ステップイン）

VBEで `F8` キーを使うと、**1行ずつ処理を実行**でき、どこで何が起きているかを確認できます。

## ブレークポイントの設置

コード左端をクリックすると●（赤丸）が表示され、**そこまで処理を進めたところで一時停止**できます。

## 変数の中身を確認

* カーソルを変数の上に置くと、現在の値がポップアップ表示されます。
* 「ローカルウィンドウ」「ウォッチウィンドウ」なども活用できます。

# よくあるエラーと対策

| エラー内容                   | 原因と対策                      |
| ----------------------- | -------------------------- |
| 型が一致しません（Type Mismatch） | 異なるデータ型を無理に代入しようとしている      |
| インデックスが有効範囲にありません       | 配列やシートの存在チェックが不足している       |
| オブジェクトが必要です             | Set文忘れや参照切れなど、オブジェクト変数が未設定 |

# まとめ

* `On Error` を使えば、**処理中のエラーに備える**ことができる
* `F8` やブレークポイントなどを使って、**コードの流れを丁寧に追う**ことでバグを見つけやすくなる
* 「無視」ではなく「対応」する姿勢が、安定したコードのカギ

次回は、\*\*「コレクションAPI」\*\*について学び、複数のデータを効率よく扱う方法を紹介します。
